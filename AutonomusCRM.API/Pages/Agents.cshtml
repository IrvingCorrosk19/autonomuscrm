@page
@model AutonomusCRM.API.Pages.AgentsModel
@{
    ViewData["Title"] = "Agentes IA - AUTONOMUS CRM";
}

<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar-left">
    <div class="kicker">Agentes aut√≥nomos</div>
    <h2 class="headline">Sistema multi-agente en tiempo real</h2>
  </div>

  <div class="topbar-center">
    <div class="search" role="search">
      <input type="text" placeholder="Buscar agentes, decisiones, acciones..." aria-label="Buscar" />
      <span class="chip">Filtros</span>
      <span class="chip">Estado</span>
    </div>
  </div>

  <div class="topbar-right">
    <button class="btn mobile-toggle" type="button" onclick="toggleSidebar()">Men√∫</button>
    <button class="btn" type="button" onclick="showAllAgentsConfig()">Configurar</button>
    <a href="/Audit" class="btn primary" style="text-decoration:none; display:inline-block;">Ver auditor√≠a</a>
  </div>
</header>

<!-- STATS -->
<section class="stats" aria-label="M√©tricas de agentes">
  <div class="stat">
    <div class="label">Agentes activos</div>
    <div class="value">7 / 7</div>
    <div class="hint">
      <span>100% operativo</span>
      <span class="delta up">‚úì</span>
    </div>
  </div>

  <div class="stat">
    <div class="label">Decisiones hoy</div>
    <div class="value">1,247</div>
    <div class="hint">
      <span>Acciones ejecutadas</span>
      <span class="delta up">+18%</span>
    </div>
  </div>

  <div class="stat">
    <div class="label">Confianza promedio</div>
    <div class="value">0.84</div>
    <div class="hint">
      <span>Score de IA</span>
      <span class="delta up">+0.05</span>
    </div>
  </div>

  <div class="stat">
    <div class="label">Tiempo respuesta</div>
    <div class="value">2.3s</div>
    <div class="hint">
      <span>Promedio</span>
      <span class="delta up">-0.4s</span>
    </div>
  </div>
</section>

<section class="grid">
  <!-- LEFT: Agents List -->
  <div class="card">
    <div class="card-h">
      <div>
        <h3 class="title">Agentes aut√≥nomos</h3>
        <p class="subtitle">
          Estado, actividad y decisiones de cada agente especializado del sistema.
        </p>
      </div>
      <span class="pill">7 agentes</span>
    </div>

    <div class="card-b">
      <div class="feed">
        <div class="item">
          <div class="itop">
            <div class="itag">LEAD INTELLIGENCE</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("LeadIntelligenceAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("LeadIntelligenceAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Analiza y califica leads autom√°ticamente. 342 leads procesados hoy, score promedio 72.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Confianza m√≠nima: @(Model.AgentConfigs.GetValueOrDefault("LeadIntelligenceAgent")?.GetValueOrDefault("MinConfidence") ?? 0.7)
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 342</span>
            <span class="pill">Confianza: 0.87</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('LeadIntelligenceAgent')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">CUSTOMER RISK</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("CustomerRiskAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("CustomerRiskAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Monitorea riesgo de churn y calcula LTV. 23 clientes en riesgo detectados, 5 acciones recomendadas.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Umbral alto riesgo: @(Model.AgentConfigs.GetValueOrDefault("CustomerRiskAgent")?.GetValueOrDefault("HighRiskThreshold") ?? 70)
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 89</span>
            <span class="pill">Confianza: 0.82</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('CustomerRiskAgent')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">DEAL STRATEGY</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("DealStrategyAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("DealStrategyAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Optimiza estrategia de cierre y calcula probabilidades. 47 deals analizados, 12 recomendaciones.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Umbral LTV alto valor: @(Model.AgentConfigs.GetValueOrDefault("DealStrategyAgent")?.GetValueOrDefault("HighValueLTVThreshold") ?? 10000)
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 124</span>
            <span class="pill">Confianza: 0.85</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('DealStrategyAgent')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">COMMUNICATION</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("CommunicationAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("CommunicationAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Gestiona comunicaciones multicanal. 156 mensajes enviados, 89% tasa de apertura.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Email bienvenida: @((Model.AgentConfigs.GetValueOrDefault("CommunicationAgent")?.GetValueOrDefault("AutoWelcomeEmail")?.ToString() == "True") ? "Activado" : "Desactivado")
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 156</span>
            <span class="pill">Confianza: 0.79</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('CommunicationAgent')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">DATA QUALITY</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("DataQualityGuardian")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("DataQualityGuardian")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Detecta y corrige problemas de calidad de datos. 67 correcciones aplicadas, 12 pendientes.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Auto-correcci√≥n: @((Model.AgentConfigs.GetValueOrDefault("DataQualityGuardian")?.GetValueOrDefault("AutoFixEnabled")?.ToString() == "True") ? "Activada" : "Desactivada")
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 67</span>
            <span class="pill">Confianza: 0.91</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('DataQualityGuardian')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">COMPLIANCE & SECURITY</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("ComplianceSecurityAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("ComplianceSecurityAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Monitorea cumplimiento y seguridad. 0 incidentes, 234 verificaciones realizadas.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Bloqueo kill-switch: @((Model.AgentConfigs.GetValueOrDefault("ComplianceSecurityAgent")?.GetValueOrDefault("BlockOnKillSwitch")?.ToString() == "True") ? "Activado" : "Desactivado")
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 234</span>
            <span class="pill">Confianza: 0.95</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('ComplianceSecurityAgent')">Configurar</button>
          </div>
        </div>

        <div class="item">
          <div class="itop">
            <div class="itag">AUTOMATION OPTIMIZER</div>
            <div class="itime">
              <span class="badge @((Model.AgentConfigs.GetValueOrDefault("AutomationOptimizerAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "ok" : "danger")">
                @((Model.AgentConfigs.GetValueOrDefault("AutomationOptimizerAgent")?.GetValueOrDefault("IsEnabled")?.ToString() == "True") ? "Activo" : "Inactivo")
              </span>
            </div>
          </div>
          <div class="ibody">
            Optimiza workflows y procesos autom√°ticos. 12 optimizaciones sugeridas, 8 aplicadas.
            <div style="margin-top: 8px; font-size: 12px; color: var(--muted);">
              Aplicaci√≥n autom√°tica: @((Model.AgentConfigs.GetValueOrDefault("AutomationOptimizerAgent")?.GetValueOrDefault("AutoApplyOptimizations")?.ToString() == "True") ? "Activada" : "Desactivada")
            </div>
          </div>
          <div class="ifooter">
            <span class="pill">Decisiones: 45</span>
            <span class="pill">Confianza: 0.88</span>
            <button class="btn" type="button" style="padding:4px 8px; font-size:11px;" onclick="showAgentConfigModal('AutomationOptimizerAgent')">Configurar</button>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a href="/Audit" class="btn" style="text-decoration:none; display:inline-block;">Ver auditor√≠a</a>
        <button class="btn primary" type="button" onclick="showAllAgentsConfig()">Configurar todos</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: Activity Feed -->
  <aside class="stack">
    <div class="card">
      <div class="card-h">
        <div>
          <h3 class="title">Actividad reciente</h3>
          <p class="subtitle">√öltimas decisiones y acciones de los agentes aut√≥nomos.</p>
        </div>
        <span class="pill">Tiempo real</span>
      </div>
      <div class="card-b">
        <div class="feed">
          <div class="item">
            <div class="itop">
              <div class="itag">DECISI√ìN</div>
              <div class="itime">Hace 2 min</div>
            </div>
            <div class="ibody">
              Lead Intelligence: Lead "Juan P√©rez" calificado con score 85. Recomendaci√≥n: enviar propuesta.
            </div>
            <div class="ifooter">
              <span class="pill">Confianza: 0.87</span>
              <span class="pill">Aprobada</span>
            </div>
          </div>

          <div class="item">
            <div class="itop">
              <div class="itag">ALERTA</div>
              <div class="itime">Hace 5 min</div>
            </div>
            <div class="ibody">
              Customer Risk: Cliente "Comercio DEF" en riesgo alto (score 78). Acci√≥n: retenci√≥n urgente.
            </div>
            <div class="ifooter">
              <span class="pill">Confianza: 0.82</span>
              <span class="pill">Pendiente</span>
            </div>
          </div>

          <div class="item">
            <div class="itop">
              <div class="itag">OPTIMIZACI√ìN</div>
              <div class="itime">Hace 8 min</div>
            </div>
            <div class="ibody">
              Automation Optimizer: Workflow "Lead Follow-up" optimizado. Tiempo reducido 23%.
            </div>
            <div class="ifooter">
              <span class="pill">Confianza: 0.88</span>
              <span class="pill">Aplicada</span>
            </div>
          </div>
        </div>

        <div style="height:12px"></div>

        <a href="/Audit" class="btn primary" style="width:100%; text-align:center; text-decoration:none; display:block;">Ver auditor√≠a completa</a>
      </div>
    </div>

    <div class="card">
      <div class="card-h">
        <div>
          <h3 class="title">Rendimiento</h3>
          <p class="subtitle">M√©tricas de eficiencia y precisi√≥n de los agentes.</p>
        </div>
        <span class="pill">√öltimas 24h</span>
      </div>
      <div class="card-b">
        <table class="table" aria-label="Rendimiento de agentes">
          <thead>
            <tr>
              <th>Agente</th>
              <th>Decisiones</th>
              <th>Precisi√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Lead Intelligence</td>
              <td>342</td>
              <td><span class="badge ok">87%</span></td>
            </tr>
            <tr>
              <td>Customer Risk</td>
              <td>89</td>
              <td><span class="badge ok">82%</span></td>
            </tr>
            <tr>
              <td>Deal Strategy</td>
              <td>124</td>
              <td><span class="badge ok">85%</span></td>
            </tr>
            <tr>
              <td>Communication</td>
              <td>156</td>
              <td><span class="badge warn">79%</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </aside>
</section>

<div style="height:14px"></div>

<footer style="color:rgba(255,255,255,0.55); font-size:12px; padding:8px 2px;">
  AUTONOMUS CRM ¬∑ Sistema multi-agente aut√≥nomo con inteligencia distribuida.
</footer>

@if (TempData["SuccessMessage"] != null)
{
  <div style="background: rgba(0, 255, 0, 0.1); border: 1px solid rgba(0, 255, 0, 0.3); padding: 15px; border-radius: 4px; margin-bottom: 20px; color: #51cf66; position: fixed; top: 80px; right: 20px; z-index: 1000; max-width: 400px;">
    <strong>‚úì √âxito:</strong> @TempData["SuccessMessage"]
  </div>
}

@if (TempData["ErrorMessage"] != null)
{
  <div style="background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3); padding: 15px; border-radius: 4px; margin-bottom: 20px; color: #ff6b6b; position: fixed; top: 80px; right: 20px; z-index: 1000; max-width: 400px;">
    <strong>‚úó Error:</strong> @TempData["ErrorMessage"]
  </div>
}

<!-- Modal de configuraci√≥n de agente -->
<div id="agentConfigModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;">
    <div class="card" style="max-width: 900px; margin: auto; position: relative; top: 50px;">
        <div class="card-h">
            <div>
                <h3 class="title" id="agentConfigTitle">‚öôÔ∏è Configurar Agente</h3>
                <p class="subtitle" id="agentConfigSubtitle" style="margin-top: 5px; color: var(--muted); font-size: 13px;">
                    <!-- Se llena din√°micamente -->
                </p>
            </div>
        </div>
        <div class="card-b">
            <!-- Tutorial/Gu√≠a -->
            <div id="agentTutorial" style="background: rgba(74, 144, 226, 0.1); border-left: 4px solid #4a90e2; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
                <div style="display: flex; align-items: start; gap: 10px;">
                    <div style="font-size: 24px;">üìö</div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 10px 0; color: #4a90e2; font-size: 16px;">Tutorial de Configuraci√≥n</h4>
                        <div id="tutorialContent" style="font-size: 13px; line-height: 1.6; color: var(--text);">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <form id="agentConfigForm" method="post" asp-page-handler="UpdateAgentConfig">
                <input type="hidden" id="agentNameInput" name="agentName" />
                <input type="hidden" id="configJsonInput" name="configJson" />
                <div id="agentConfigContent">
                    <!-- El contenido se genera din√°micamente con JavaScript -->
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="btn primary" style="flex: 1;">üíæ Guardar configuraci√≥n</button>
                    <button type="button" class="btn" onclick="closeAgentConfigModal()" style="flex: 1;">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
const agentConfigs = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.AgentConfigs));

function showAgentConfigModal(agentName) {
    document.getElementById('agentNameInput').value = agentName;
    const displayName = getAgentDisplayName(agentName);
    document.getElementById('agentConfigTitle').textContent = '‚öôÔ∏è Configurar: ' + displayName;
    
    // Actualizar subt√≠tulo con descripci√≥n del agente
    const descriptions = {
        'LeadIntelligenceAgent': 'Analiza y califica leads autom√°ticamente bas√°ndose en fuente, informaci√≥n disponible y comportamiento',
        'CustomerRiskAgent': 'Eval√∫a riesgo de clientes, detecta churn potencial y calcula lifetime value',
        'DealStrategyAgent': 'Optimiza estrategias de cierre de deals, calcula probabilidades y sugiere acciones',
        'CommunicationAgent': 'Gestiona comunicaciones multicanal autom√°ticas basadas en eventos del sistema',
        'DataQualityGuardian': 'Detecta y corrige problemas de calidad de datos, valida integridad y consistencia',
        'ComplianceSecurityAgent': 'Monitorea compliance, seguridad y auditor√≠a de todos los eventos del sistema',
        'AutomationOptimizerAgent': 'Optimiza workflows y automatizaciones bas√°ndose en m√©tricas de rendimiento'
    };
    document.getElementById('agentConfigSubtitle').textContent = descriptions[agentName] || '';
    
    // Mostrar tutorial
    const tutorial = generateTutorial(agentName);
    document.getElementById('tutorialContent').innerHTML = tutorial;
    
    const config = agentConfigs[agentName] || {};
    const content = generateConfigForm(agentName, config);
    document.getElementById('agentConfigContent').innerHTML = content;
    
    document.getElementById('agentConfigModal').style.display = 'flex';
}

function showAllAgentsConfig() {
    showAgentConfigModal('LeadIntelligenceAgent');
}

function closeAgentConfigModal() {
    document.getElementById('agentConfigModal').style.display = 'none';
}

function getAgentDisplayName(agentName) {
    const names = {
        'LeadIntelligenceAgent': 'Lead Intelligence Agent',
        'CustomerRiskAgent': 'Customer Risk Agent',
        'DealStrategyAgent': 'Deal Strategy Agent',
        'CommunicationAgent': 'Communication Agent',
        'DataQualityGuardian': 'Data Quality Guardian',
        'ComplianceSecurityAgent': 'Compliance & Security Agent',
        'AutomationOptimizerAgent': 'Automation Optimizer Agent'
    };
    return names[agentName] || agentName;
}

function generateTutorial(agentName) {
    const tutorials = {
        'LeadIntelligenceAgent': `
            <p><strong>üìã C√≥mo configurar el Lead Intelligence Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente procese eventos de leads autom√°ticamente.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0) requerido para que el agente ejecute acciones. Valores m√°s altos = m√°s conservador.</li>
                <li><strong>Pesos de Scoring por Fuente:</strong> Ajusta los puntos que se asignan seg√∫n la fuente del lead:
                    <ul style="margin-top: 5px;">
                        <li><strong>Referral:</strong> Leads referidos (mayor valor, t√≠picamente 30 puntos)</li>
                        <li><strong>Website:</strong> Leads del sitio web (valor medio, t√≠picamente 20 puntos)</li>
                        <li><strong>Social Media:</strong> Leads de redes sociales (valor medio-bajo, t√≠picamente 15 puntos)</li>
                        <li><strong>Email Campaign:</strong> Leads de campa√±as de email (valor bajo, t√≠picamente 10 puntos)</li>
                    </ul>
                </li>
                <li><strong>Pesos de Contacto:</strong> Define los puntos adicionales seg√∫n informaci√≥n disponible:
                    <ul style="margin-top: 5px;">
                        <li><strong>Email:</strong> Puntos por tener email v√°lido (t√≠picamente 15 puntos)</li>
                        <li><strong>Tel√©fono:</strong> Puntos por tener tel√©fono (t√≠picamente 10 puntos)</li>
                        <li><strong>Empresa:</strong> Puntos por tener nombre de empresa (t√≠picamente 20 puntos)</li>
                    </ul>
                </li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> El score m√°ximo es 100. Ajusta los pesos para priorizar las fuentes y contactos m√°s valiosos para tu negocio.
            </p>
        `,
        'CustomerRiskAgent': `
            <p><strong>üìã C√≥mo configurar el Customer Risk Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente eval√∫e el riesgo de clientes autom√°ticamente.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.75 para evaluaciones de riesgo.</li>
                <li><strong>Score de riesgo base:</strong> El punto de partida para calcular el riesgo (0-100). T√≠picamente 50 (riesgo medio).</li>
                <li><strong>Umbral alto riesgo:</strong> Score por encima del cual un cliente se considera de alto riesgo (t√≠picamente 70).</li>
                <li><strong>Umbral bajo riesgo:</strong> Score por debajo del cual un cliente se considera de bajo riesgo (t√≠picamente 30).</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> Los clientes con score alto requieren atenci√≥n inmediata para prevenir churn. Los de bajo riesgo son candidatos para programas de lealtad.
            </p>
        `,
        'DealStrategyAgent': `
            <p><strong>üìã C√≥mo configurar el Deal Strategy Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente analice deals y sugiera estrategias.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.8 para estrategias de cierre.</li>
                <li><strong>Umbral LTV alto valor:</strong> Lifetime Value m√≠nimo para considerar un cliente de alto valor (t√≠picamente $10,000).</li>
                <li><strong>D√≠as estancado (umbral):</strong> N√∫mero de d√≠as en una etapa antes de considerar el deal estancado (t√≠picamente 30 d√≠as).</li>
                <li><strong>Umbral probabilidad riesgo:</strong> Probabilidad m√≠nima para considerar un deal en riesgo (t√≠picamente 30%).</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> El agente detecta autom√°ticamente deals en riesgo y sugiere acciones espec√≠ficas seg√∫n la etapa del deal. Revisa las sugerencias regularmente.
            </p>
        `,
        'CommunicationAgent': `
            <p><strong>üìã C√≥mo configurar el Communication Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente gestione comunicaciones autom√°ticas.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.7 para comunicaciones.</li>
                <li><strong>Email de bienvenida autom√°tico:</strong> Activa para enviar autom√°ticamente un email de bienvenida cuando se crea un nuevo cliente.</li>
                <li><strong>Seguimiento autom√°tico:</strong> Activa para programar seguimientos autom√°ticos basados en eventos del sistema.</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> El agente calcula autom√°ticamente el mejor momento para contactar (horario de oficina: 9-11 AM y 2-4 PM). Las comunicaciones se programan seg√∫n estos horarios √≥ptimos.
            </p>
        `,
        'DataQualityGuardian': `
            <p><strong>üìã C√≥mo configurar el Data Quality Guardian:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente escanee la calidad de datos peri√≥dicamente.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.9 para validaciones de datos.</li>
                <li><strong>Auto-correcci√≥n habilitada:</strong> Activa para que el agente corrija autom√°ticamente problemas detectados (ej: formato de email, tel√©fono).</li>
                <li><strong>Intervalo de escaneo:</strong> Frecuencia en minutos para escanear datos (t√≠picamente 60 minutos). Valores m√°s bajos = m√°s frecuente pero m√°s carga en el sistema.</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> Si activas auto-correcci√≥n, el agente intentar√° corregir autom√°ticamente formatos inv√°lidos. Si est√° desactivada, solo reportar√° problemas para revisi√≥n manual.
            </p>
        `,
        'ComplianceSecurityAgent': `
            <p><strong>üìã C√≥mo configurar el Compliance & Security Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente monitoree compliance y seguridad.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.95 para seguridad.</li>
                <li><strong>Requerir CorrelationId:</strong> Activa para que todos los eventos requieran un CorrelationId (trazabilidad).</li>
                <li><strong>Requerir TenantId:</strong> Activa para que todos los eventos requieran un TenantId (multi-tenancy).</li>
                <li><strong>Bloquear cuando kill-switch est√° activo:</strong> Activa para bloquear todos los eventos cuando el kill-switch del tenant est√° activado.</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>‚ö†Ô∏è Importante:</strong> Este agente es cr√≠tico para la seguridad y compliance. Se recomienda mantener todas las opciones activadas en producci√≥n. El kill-switch permite desactivar completamente un tenant en caso de emergencia.
            </p>
        `,
        'AutomationOptimizerAgent': `
            <p><strong>üìã C√≥mo configurar el Automation Optimizer Agent:</strong></p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Activar el agente:</strong> Marca la casilla "Agente activo" para que el agente analice y optimice workflows.</li>
                <li><strong>Confianza m√≠nima:</strong> Establece el nivel m√≠nimo de confianza (0.0-1.0). Recomendado: 0.85 para optimizaciones.</li>
                <li><strong>Aplicar optimizaciones autom√°ticamente:</strong> Activa para aplicar optimizaciones sugeridas sin aprobaci√≥n manual. Si est√° desactivada, solo sugerir√° mejoras.</li>
                <li><strong>Intervalo de an√°lisis:</strong> Frecuencia en minutos para analizar workflows (t√≠picamente 120 minutos).</li>
                <li><strong>Umbral de optimizaci√≥n:</strong> Mejora m√≠nima requerida (0.0-1.0) para considerar una optimizaci√≥n v√°lida (t√≠picamente 0.1 = 10% de mejora).</li>
            </ol>
            <p style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                <strong>üí° Consejo:</strong> Si activas "Aplicar optimizaciones autom√°ticamente", el agente aplicar√° mejoras sin tu aprobaci√≥n. Recomendado: desactivar inicialmente para revisar sugerencias, luego activar cuando tengas confianza en el sistema.
            </p>
        `
    };
    
    return tutorials[agentName] || '<p>Configuraci√≥n del agente. Ajusta los par√°metros seg√∫n tus necesidades.</p>';
}

function generateConfigForm(agentName, config) {
    let html = '<div style="display: flex; flex-direction: column; gap: 20px;">';
    
    // Secci√≥n: Configuraci√≥n General
    html += `
        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
            <h4 style="margin: 0 0 15px 0; color: var(--text); font-size: 16px;">‚öôÔ∏è Configuraci√≥n General</h4>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <div>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="IsEnabled" ${config.IsEnabled?.ToString() == "True" ? 'checked' : ''} 
                               style="width: 20px; height: 20px; cursor: pointer;" />
                        <span style="font-weight: 600;">‚úÖ Agente activo</span>
                    </label>
                    <div style="font-size: 12px; color: var(--muted); margin-top: 5px; margin-left: 30px;">
                        Activa o desactiva el procesamiento de eventos por este agente. Si est√° desactivado, el agente no procesar√° ning√∫n evento.
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">üéØ Confianza m√≠nima (0.0 - 1.0)</label>
                    <input type="number" id="MinConfidence" step="0.01" min="0" max="1" 
                           value="${config.MinConfidence ?? 0.75}" 
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                    <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">
                        Nivel m√≠nimo de confianza requerido para que el agente ejecute acciones. Valores m√°s altos = m√°s conservador (menos acciones autom√°ticas).
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Secci√≥n: Configuraci√≥n Espec√≠fica del Agente
    html += `
        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
            <h4 style="margin: 0 0 15px 0; color: var(--text); font-size: 16px;">üîß Configuraci√≥n Espec√≠fica</h4>
    `;
    
    if (agentName === 'LeadIntelligenceAgent') {
        html += generateLeadIntelligenceConfig(config);
    } else if (agentName === 'CustomerRiskAgent') {
        html += generateCustomerRiskConfig(config);
    } else if (agentName === 'DealStrategyAgent') {
        html += generateDealStrategyConfig(config);
    } else if (agentName === 'CommunicationAgent') {
        html += generateCommunicationConfig(config);
    } else if (agentName === 'DataQualityGuardian') {
        html += generateDataQualityConfig(config);
    } else if (agentName === 'ComplianceSecurityAgent') {
        html += generateComplianceConfig(config);
    } else if (agentName === 'AutomationOptimizerAgent') {
        html += generateAutomationOptimizerConfig(config);
    }
    
    html += '</div>'; // Cierra configuraci√≥n espec√≠fica
    html += '</div>'; // Cierra contenedor principal
    return html;
}

function generateLeadIntelligenceConfig(config) {
    const sourceWeights = config.SourceWeights || {};
    const contactWeights = config.ContactWeights || {};
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <h5 style="margin: 0 0 10px 0; color: var(--text); font-size: 14px;">üìä Pesos de Scoring por Fuente</h5>
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Ajusta los puntos que se asignan seg√∫n la fuente del lead. Mayor valor = mayor prioridad.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-size: 12px;">Referral</label>
                    <input type="number" id="SourceWeight_Referral" value="${sourceWeights.Referral || 30}" 
                           style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-size: 12px;">Website</label>
                    <input type="number" id="SourceWeight_Website" value="${sourceWeights.Website || 20}" 
                           style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-size: 12px;">Social Media</label>
                    <input type="number" id="SourceWeight_SocialMedia" value="${sourceWeights.SocialMedia || 15}" 
                           style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-size: 12px;">Email Campaign</label>
                    <input type="number" id="SourceWeight_EmailCampaign" value="${sourceWeights.EmailCampaign || 10}" 
                           style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
            </div>
            <div style="margin-top: 15px;">
                <h5 style="margin: 0 0 10px 0; color: var(--text); font-size: 14px;">üìû Pesos de Contacto</h5>
                <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Puntos adicionales seg√∫n informaci√≥n de contacto disponible.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px;">Email</label>
                        <input type="number" id="ContactWeight_Email" value="${contactWeights.Email || 15}" 
                               style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px;">Tel√©fono</label>
                        <input type="number" id="ContactWeight_Phone" value="${contactWeights.Phone || 10}" 
                               style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px;">Empresa</label>
                        <input type="number" id="ContactWeight_Company" value="${contactWeights.Company || 20}" 
                               style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateCustomerRiskConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Configura los umbrales y par√°metros para la evaluaci√≥n de riesgo de clientes.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Score de riesgo base</label>
                    <input type="number" id="BaseRiskScore" value="${config.BaseRiskScore ?? 50}" min="0" max="100"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Umbral alto riesgo</label>
                    <input type="number" id="HighRiskThreshold" value="${config.HighRiskThreshold ?? 70}" min="0" max="100"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Umbral bajo riesgo</label>
                    <input type="number" id="LowRiskThreshold" value="${config.LowRiskThreshold ?? 30}" min="0" max="100"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
            </div>
        </div>
    `;
}

function generateDealStrategyConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Configura los par√°metros para el an√°lisis estrat√©gico de deals y detecci√≥n de riesgos.</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Umbral LTV alto valor</label>
                    <input type="number" id="HighValueLTVThreshold" value="${config.HighValueLTVThreshold ?? 10000}" min="0"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">D√≠as estancado (umbral)</label>
                    <input type="number" id="StagnantDaysThreshold" value="${config.StagnantDaysThreshold ?? 30}" min="0"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Umbral probabilidad riesgo</label>
                    <input type="number" id="RiskProbabilityThreshold" value="${config.RiskProbabilityThreshold ?? 30}" min="0" max="100"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
            </div>
        </div>
    `;
}

function generateCommunicationConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Configura las opciones de comunicaci√≥n autom√°tica del agente.</p>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="AutoWelcomeEmail" ${config.AutoWelcomeEmail?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Email de bienvenida autom√°tico</span>
                </label>
            </div>
            <div>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="AutoFollowUp" ${config.AutoFollowUp?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Seguimiento autom√°tico</span>
                </label>
            </div>
        </div>
    `;
}

function generateDataQualityConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Configura la frecuencia de escaneo y las opciones de correcci√≥n autom√°tica.</p>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="AutoFixEnabled" ${config.AutoFixEnabled?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Auto-correcci√≥n habilitada</span>
                </label>
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Intervalo de escaneo (minutos)</label>
                <input type="number" id="ScanIntervalMinutes" value="${config.ScanIntervalMinutes ?? 60}" min="1"
                       style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
            </div>
        </div>
    `;
}

function generateComplianceConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px; padding: 10px; background: rgba(255, 193, 7, 0.1); border-left: 3px solid #ffc107; border-radius: 4px;">
                ‚ö†Ô∏è <strong>Importante:</strong> Estas configuraciones son cr√≠ticas para la seguridad y compliance. Se recomienda mantener todas activadas en producci√≥n.
            </p>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="RequireCorrelationId" ${config.RequireCorrelationId?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Requerir CorrelationId</span>
                </label>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="RequireTenantId" ${config.RequireTenantId?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Requerir TenantId</span>
                </label>
            </div>
            <div>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="BlockOnKillSwitch" ${config.BlockOnKillSwitch?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Bloquear cuando kill-switch est√° activo</span>
                </label>
            </div>
        </div>
    `;
}

function generateAutomationOptimizerConfig(config) {
    return `
        <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 4px;">
            <p style="font-size: 12px; color: var(--muted); margin-bottom: 15px;">Configura c√≥mo el agente analiza y optimiza workflows autom√°ticamente.</p>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="AutoApplyOptimizations" ${config.AutoApplyOptimizations?.ToString() == "True" ? 'checked' : ''} 
                           style="width: 20px; height: 20px; cursor: pointer;" />
                    <span style="font-weight: 600;">Aplicar optimizaciones autom√°ticamente</span>
                </label>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Intervalo de an√°lisis (minutos)</label>
                    <input type="number" id="AnalysisIntervalMinutes" value="${config.AnalysisIntervalMinutes ?? 120}" min="1"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Umbral de optimizaci√≥n (0.0 - 1.0)</label>
                    <input type="number" id="OptimizationThreshold" step="0.01" min="0" max="1" value="${config.OptimizationThreshold ?? 0.1}"
                           style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg); color: var(--text); border-radius: 4px;" />
                </div>
            </div>
        </div>
    `;
}

document.getElementById('agentConfigForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const agentName = document.getElementById('agentNameInput').value;
    const config = {};
    
    config.IsEnabled = document.getElementById('IsEnabled').checked;
    config.MinConfidence = parseFloat(document.getElementById('MinConfidence').value);
    
    if (agentName === 'LeadIntelligenceAgent') {
        config.SourceWeights = {
            Referral: parseInt(document.getElementById('SourceWeight_Referral').value),
            Website: parseInt(document.getElementById('SourceWeight_Website').value),
            SocialMedia: parseInt(document.getElementById('SourceWeight_SocialMedia').value),
            EmailCampaign: parseInt(document.getElementById('SourceWeight_EmailCampaign').value)
        };
        config.ContactWeights = {
            Email: parseInt(document.getElementById('ContactWeight_Email').value),
            Phone: parseInt(document.getElementById('ContactWeight_Phone').value),
            Company: parseInt(document.getElementById('ContactWeight_Company').value)
        };
    } else if (agentName === 'CustomerRiskAgent') {
        config.BaseRiskScore = parseInt(document.getElementById('BaseRiskScore').value);
        config.HighRiskThreshold = parseInt(document.getElementById('HighRiskThreshold').value);
        config.LowRiskThreshold = parseInt(document.getElementById('LowRiskThreshold').value);
    } else if (agentName === 'DealStrategyAgent') {
        config.HighValueLTVThreshold = parseInt(document.getElementById('HighValueLTVThreshold').value);
        config.StagnantDaysThreshold = parseInt(document.getElementById('StagnantDaysThreshold').value);
        config.RiskProbabilityThreshold = parseInt(document.getElementById('RiskProbabilityThreshold').value);
    } else if (agentName === 'CommunicationAgent') {
        config.AutoWelcomeEmail = document.getElementById('AutoWelcomeEmail').checked;
        config.AutoFollowUp = document.getElementById('AutoFollowUp').checked;
    } else if (agentName === 'DataQualityGuardian') {
        config.AutoFixEnabled = document.getElementById('AutoFixEnabled').checked;
        config.ScanIntervalMinutes = parseInt(document.getElementById('ScanIntervalMinutes').value);
    } else if (agentName === 'ComplianceSecurityAgent') {
        config.RequireCorrelationId = document.getElementById('RequireCorrelationId').checked;
        config.RequireTenantId = document.getElementById('RequireTenantId').checked;
        config.BlockOnKillSwitch = document.getElementById('BlockOnKillSwitch').checked;
    } else if (agentName === 'AutomationOptimizerAgent') {
        config.AutoApplyOptimizations = document.getElementById('AutoApplyOptimizations').checked;
        config.AnalysisIntervalMinutes = parseInt(document.getElementById('AnalysisIntervalMinutes').value);
        config.OptimizationThreshold = parseFloat(document.getElementById('OptimizationThreshold').value);
    }
    
    document.getElementById('configJsonInput').value = JSON.stringify(config);
    this.submit();
});
</script>

